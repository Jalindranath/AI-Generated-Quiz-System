<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI PDF Quiz - Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <div id="quizContainer"></div>
  </div>

  <script>
    let currentQuestion = 0, questions = [], score = 0, timers = [], startTime, timeTaken = [];

    window.onload = () => {
      const stored = localStorage.getItem("quizQuestions");
      if (!stored) return window.location.href = "index.html";
      questions = JSON.parse(stored);
      showQuestion();
    }

   function showQuestion() {
  if (currentQuestion >= questions.length) {
    localStorage.setItem("quizScore", score);
    localStorage.setItem("timeTaken", JSON.stringify(timeTaken));
    window.location.href = "result.html";
    return;
  }

  const q = questions[currentQuestion];
  const container = document.getElementById("quizContainer");
  let questionHTML = "";

  // Intelligent formatting based on question type
  if (/‡§µ‡§ø‡§ß‡§æ‡§®\s?I/.test(q.question)) {
    // Format statement questions (I, II...)
    const parts = q.question.split(/\n/).filter(Boolean);
    questionHTML += `<p class="fw-bold">${parts[0]}</p>`;
    for (let i = 1; i < parts.length; i++) {
      questionHTML += `<p class="ms-3">üìå ${parts[i]}</p>`;
    }
  } else if (q.question.includes("‡§ú‡•ã‡§°‡•ç‡§Ø‡§æ ‡§≤‡§æ‡§µ‡§æ") || q.question.includes("‡§∏‡•ç‡§§‡§Ç‡§≠ A")) {
    // Matching question formatting
    questionHTML += `<p class="fw-bold mb-2">${q.question.split('\n')[0]}</p>`;
    const rows = q.question.split('\n').slice(1);
    questionHTML += '<div class="row"><div class="col-md-6"><strong>‡§∏‡•ç‡§§‡§Ç‡§≠ A</strong><ul>';
    rows.forEach(line => {
      if (line.includes('(a)') || line.includes('(b)') || line.includes('(c)')) {
        questionHTML += `<li>${line.split('(')[1].split(')')[0]}. ${line.split(')')[1].split('(')[0]}</li>`;
      }
    });
    questionHTML += '</ul></div><div class="col-md-6"><strong>‡§∏‡•ç‡§§‡§Ç‡§≠ B</strong><ul>';
    rows.forEach(line => {
      if (line.includes('(i)') || line.includes('(ii)') || line.includes('(iii)')) {
        const parts = line.match(/\(.\)\s?(.*)/g);
        if (parts) {
          parts.forEach(p => {
            const label = p.match(/\((.*?)\)/)[1];
            const value = p.split(')')[1].trim();
            questionHTML += `<li>${label}. ${value}</li>`;
          });
        }
      }
    });
    questionHTML += '</ul></div></div>';
  } else if (q.question.includes("‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•ç‡§∞‡§Æ") || q.question.includes("‡§ï‡•ç‡§∞‡§Æ ‡§≤‡§æ‡§µ‡§æ")) {
    // Sequence/order type question
    const lines = q.question.split('\n');
    questionHTML += `<p class="fw-bold">${lines[0]}</p>`;
    lines.slice(1).forEach(line => {
      questionHTML += `<p class="ms-3">üî¢ ${line}</p>`;
    });
  } else {
    // Default plain question
    questionHTML += `<p>${q.question}</p>`;
  }

  // Render options
  questionHTML += q.options.map((opt, i) => `
    <div class="form-check mb-2">
      <input class="form-check-input" type="radio" name="q${currentQuestion}" value="${i}" id="opt${i}">
      <label class="form-check-label" for="opt${i}">${opt}</label>
    </div>`).join('');

  container.innerHTML = `
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between mb-3">
          <h5 class="card-title">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}:</h5>
          <div class="text-danger fw-bold" id="timer">‚è≥ 0s</div>
        </div>
        ${questionHTML}
        <button class="btn btn-success mt-3" onclick="submitAnswer()">Submit</button>
      </div>
    </div>`;

  startTime = new Date();
  runTimer();
}


    function runTimer() {
      let sec = 0;
      const timerElem = document.getElementById("timer");
      const interval = setInterval(() => {
        sec++;
        timerElem.innerText = `‚è≥ ${sec}s`;
      }, 1000);
      timers.push(interval);
    }

    function stopTimer() {
      timers.forEach(t => clearInterval(t));
      timers = [];
      const endTime = new Date();
      timeTaken.push(Math.round((endTime - startTime) / 1000));
    }

    function submitAnswer() {
      const selected = document.querySelector(`input[name='q${currentQuestion}']:checked`);
      if (!selected) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ");

      stopTimer();
      const answer = parseInt(selected.value);
      const correct = questions[currentQuestion].correct_index;
      if (answer === correct) {
        score++;
        selected.parentElement.classList.add("bg-success", "text-white", "p-2", "rounded");
      } else {
        selected.parentElement.classList.add("bg-danger", "text-white", "p-2", "rounded");
        document.querySelector(`input[value='${correct}']`).parentElement.classList.add("bg-success", "text-white", "p-2", "rounded");
      }

      setTimeout(() => {
        currentQuestion++;
        showQuestion();
      }, 1500);
    }
  </script>
</body>
</html>
