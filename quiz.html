<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI PDF Quiz - Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f3f5fb; }
    .quiz-card {
      max-width: 600px;
      margin: 48px auto 0 auto;
      border-radius: 18px;
      box-shadow: 0 4px 24px 0 rgba(95,112,179,0.10), 0 1.5px 4px 0 rgba(95,112,179,0.08);
      border: none;
      background: #fff;
    }
    .progress-bar {
      transition: width .4s;
    }
    .option-label {
      cursor: pointer;
      transition: background .15s;
      border-radius: 7px;
      padding: 7px 15px;
      display: block;
      border: 1px solid transparent;
    }
    .option-label.selected { border: 1.5px solid #0d6efd; background: #e7f1ff; }
    .option-label.correct { background: #d0ffd6; border-color: #1bc467; }
    .option-label.incorrect { background: #ffd6d6; border-color: #f44336; }
    .option-label.disabled { opacity: 0.75; pointer-events: none; }
    .next-btn { min-width: 120px; }
    .fade-in {
      animation: fadein .4s;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(12px);}
      to { opacity: 1; transform: none;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="quiz-card card p-4 fade-in">
      <div class="mb-3">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <span class="badge bg-primary rounded-pill" id="questionNumber"></span>
            <span class="ms-3 text-muted" id="progressText"></span>
          </div>
          <div id="timer" class="fw-bold text-secondary"></div>
        </div>
        <div class="progress mt-2" style="height:7px;">
          <div class="progress-bar bg-primary" id="progressBar"></div>
        </div>
      </div>
      <div id="questionArea"></div>
    </div>
  </div>
<script>
let questions = [],
    current = 0,
    score = 0,
    timeTaken = [],
    wrongAnswers = [],
    answered = false,
    timerInt = null,
    startTime = null;

window.onload = () => {
  const qs = localStorage.getItem("quizQuestions");
  if (!qs) return location.href = "index.html";
  questions = JSON.parse(qs);
  showQuestion();
};

function showQuestion() {
  if (current >= questions.length) {
    localStorage.setItem("quizScore", score);
    localStorage.setItem("timeTaken", JSON.stringify(timeTaken));
    localStorage.setItem("wrongAnswers", JSON.stringify(wrongAnswers));
    return location.href = "result.html";
  }

  answered = false;
  document.getElementById("questionNumber").innerText = `Q${current + 1}`;
  document.getElementById("progressText").innerText = `प्रश्न ${current + 1} / ${questions.length}`;
  document.getElementById("progressBar").style.width = ((current) / questions.length * 100) + "%";

  // Timer
  let sec = 0;
  document.getElementById("timer").innerText = "⏳ 0s";
  if (timerInt) clearInterval(timerInt);
  startTime = new Date();
  timerInt = setInterval(() => {
    sec++;
    document.getElementById("timer").innerText = `⏳ ${sec}s`;
  }, 1000);

  const q = questions[current];
  let html = `<div class="mb-3"><span class="fw-bold">${q.question}</span></div>`;
  html += q.options.map((opt, i) =>
    `<label class="option-label mt-2" id="optlbl${i}">
      <input type="radio" name="option" value="${i}" class="form-check-input me-2" style="margin-top:0.2em;">${opt}
    </label>`
  ).join('');
  html += `<div class="mt-4" id="actionBtn">
    <button class="btn btn-success next-btn" onclick="submitAnswer()">सबमिट करा</button>
  </div>`;
  document.getElementById("questionArea").innerHTML = html;
}

function submitAnswer() {
  if (answered) return;
  const selected = document.querySelector('input[name="option"]:checked');
  if (!selected) return alert("कृपया एक पर्याय निवडा");
  answered = true;
  clearInterval(timerInt);
  let spent = Math.round((new Date() - startTime) / 1000);
  timeTaken.push(spent);

  const userAns = Number(selected.value);
  const correctAns = questions[current].correct_index;
  // Mark options
  for (let i = 0; i < 4; ++i) {
    const label = document.getElementById('optlbl' + i);
    label.classList.add('disabled');
    if (i === correctAns) label.classList.add('correct');
    if (i === userAns && userAns !== correctAns) label.classList.add('incorrect');
    if (i === userAns) label.classList.add('selected');
  }
  // Handle wrong/correct logic
  if (userAns === correctAns) {
    score++;
    document.getElementById("actionBtn").innerHTML = `<span class="text-success fw-bold">✅ बरोबर!</span>`;
    setTimeout(() => { current++; showQuestion(); }, 1100);
  } else {
    // Store for review
    wrongAnswers.push({
      index: current,
      question: questions[current].question,
      options: questions[current].options,
      userAns,
      correctAns
    });
    document.getElementById("actionBtn").innerHTML =
      `<span class="text-danger fw-bold">❌ चुकीचे! योग्य उत्तर हिरव्या रंगात आहे.</span>
       <button class="btn btn-primary next-btn ms-3" onclick="gotoNext()">पुढील प्रश्न</button>`;
  }
}

function gotoNext() {
  current++;
  showQuestion();
}
</script>
</body>
</html>